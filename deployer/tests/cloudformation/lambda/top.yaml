AWSTemplateFormatVersion: 2010-09-09
Description: Configures an internal bucket to be used accross an organization
Parameters:
  Bucket:
    Description: The bucket where function code is uploaded
    Type: String
  Release:
    Description: This parameter is auto-generated by deployer
    Type: String
Resources:
  Function:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket: !Ref 'Bucket'
        S3Key: !Sub '${Release}/tests/lambda/test.zip'
      Handler: lambda_function.lambda_handler
      Role: !GetAtt 'Role.Arn'
      Runtime: python3.7
  Role:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: 2012-10-17
      Path: /
Outputs:
  Function:
    Description: Name of the created lambda function
    Value: !Ref 'Function'