{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Network Security Groups.",
  "Parameters": {
    "Environment": {
      "Description": "Environment name assigned to EC2 instances (e.g. 'prod' or 'test').",
      "Type": "String",
      "Default": "",
      "ConstraintDescription": "Must be a string."
    },
    "Project" : {
      "Description" : "Project name.",
      "Type" : "String",
      "Default" : "",
      "ConstraintDescription" : "Must be a string."
    },
    "VPCCIDR": {
      "Description": "VPCCIDR",
      "Type": "String",
      "Default" : ""
    },
    "VPC": {
      "Description": "VPC ID",
      "Type": "AWS::EC2::VPC::Id"
    },
    "ECSClusterSecurityGroup": {
      "Description": "ECS Cluster Security Group",
      "Type": "String",
      "Default": ""
    }
  },
  "Resources": {
    "ALBSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Enable ELB.",
        "VpcId": { "Ref": "VPC" },
        "SecurityGroupIngress": [
          { "IpProtocol": "tcp", "FromPort": "5001", "ToPort": "5010", "CidrIp": { "Ref": "VPCCIDR" }},
          { "IpProtocol": "tcp", "FromPort": "80", "ToPort": "80", "CidrIp": "0.0.0.0/0" }
        ],
        "SecurityGroupEgress": [
          { "IpProtocol": "tcp", "FromPort": "0", "ToPort": "65535", "SourceSecurityGroupId": { "Ref" : "ECSClusterSecurityGroup" }},
          { "IpProtocol": "tcp", "FromPort": "80", "ToPort": "80", "SourceSecurityGroupId": { "Ref" : "ECSClusterSecurityGroup" }},
          { "IpProtocol": "tcp", "FromPort": "443", "ToPort": "443", "SourceSecurityGroupId": { "Ref" : "ECSClusterSecurityGroup"}}
        ],
        "Tags" : [
          { "Key" : "Name", "Value": "ECS-ALB" }
        ]
      }
    }
  },
  "Outputs": {
    "ALBSecurityGroup": {
      "Description": "ALB Security Group ID",
      "Value": { "Ref": "ALBSecurityGroup" }
    }
  }
}
